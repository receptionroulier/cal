<div class="right">
  <h2>Calendrier</h2>
  <div id="calendar-wrapper"></div>
</div>

<script>
// ==================== CALENDRIER DANS DASHBOARD ====================
const CACHE_CAL_HTML = "cal_html_cache";
const CACHE_CAL_HASH = "cal_html_hash";
const CACHE_EXP_CAL = 120000; // 120 s

async function loadCalendarHTML() {
  try {
    const res = await fetch("https://receptionroulier.github.io/cal/calr.html");
    const html = await res.text();

    // hash pour vérifier si le contenu a changé
    const newHash = await sha256Hex(html);
    const oldHash = localStorage.getItem(CACHE_CAL_HASH);

    if(oldHash && oldHash === newHash){
      console.log("Calendrier inchangé — utilisation cache");
      document.getElementById("calendar-wrapper").innerHTML = localStorage.getItem(CACHE_CAL_HTML);
      return;
    }

    // Mise à jour du cache
    localStorage.setItem(CACHE_CAL_HTML, html);
    localStorage.setItem(CACHE_CAL_HASH, newHash);
    localStorage.setItem("cal_html_ts", Date.now());

    document.getElementById("calendar-wrapper").innerHTML = html;
    console.log("Nouveau calendrier chargé");

  } catch(e){
    console.error("Erreur calendrier:", e);
    document.getElementById("calendar-wrapper").textContent = "Impossible de charger le calendrier.";
  }
}

// Refresh automatique toutes les 60 secondes
loadCalendarHTML();
setInterval(loadCalendarHTML, 60000);
</script>
