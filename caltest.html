function createZoomClone(dayEl) {
  removeZoomClone(); 

  const content = dayEl.querySelector('.day-content');
  if (!content) return;

  zoomClone = content.cloneNode(true);
  zoomClone.classList.add('zoom-clone');

  Object.assign(zoomClone.style, {
    position: 'absolute',
    zIndex: 9998,
    boxSizing: 'border-box',
    transformOrigin: 'top left',
    pointerEvents: 'none',
    transition: 'transform 120ms ease'
  });

  const dayRect = content.getBoundingClientRect();
  const viewportW = Math.max(document.documentElement.clientWidth, window.innerWidth || 0);
  const viewportH = Math.max(document.documentElement.clientHeight, window.innerHeight || 0);
  const scrollX = window.scrollX || window.pageXOffset;
  const scrollY = window.scrollY || window.pageYOffset;

  const scale = 1.12;
  const desiredW = dayRect.width * scale;
  const desiredH = dayRect.height * scale;

  let left = dayRect.left + scrollX;
  let top = dayRect.top + scrollY;

  const maxLeft = scrollX + viewportW - desiredW - 8;
  const maxTop = scrollY + viewportH - desiredH - 8;

  if (left > maxLeft) left = Math.max(scrollX + 8, maxLeft);
  if (top > maxTop) top = Math.max(scrollY + 8, maxTop);
  if (left < scrollX + 8) left = Math.max(scrollX + 8, left);
  if (top < scrollY + 8) top = Math.max(scrollY + 8, top);

  zoomClone.style.width = dayRect.width + 'px';
  zoomClone.style.height = dayRect.height + 'px';
  zoomClone.style.left = left + 'px';
  zoomClone.style.top = top + 'px';

  if (dayEl.classList.contains('today')) {
    zoomClone.style.background = '#1f2226';
    zoomClone.style.border = '2px solid var(--accent)';
  } else {
    zoomClone.style.background = '#161819';
    zoomClone.style.border = '1px solid rgba(255,255,255,0.04)';
  }

  document.body.appendChild(zoomClone);

  // --- CORRECTION CRITIQUE Ã€ CET ENDROIT ---
  requestAnimationFrame(() => {
    if (!zoomClone) return;  // <--- protection anti-crash
    zoomClone.style.transform = `scale(${scale})`;
  });

  const cleanup = () => removeZoomClone();
  window.addEventListener('scroll', cleanup, { once: true });
  window.addEventListener('resize', cleanup, { once: true });
}
