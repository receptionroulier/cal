<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Calendrier 3-4 semaines - sombre + couleurs</title>
<style>
:root {
  --bg: #121212;
  --card: #1c1f23;
  --border: #555;
  --text: #eaeaea;
  --muted: #999;
  --accent: #00e5ff; /* couleur du titre et boutons */
  --gap: 4px;
  --days-font: 14px;
  --event-font: 14px;
}
* { box-sizing: border-box; margin:0; padding:0; }
body {
  font-family: Inter, system-ui, Arial, sans-serif;
  background: var(--bg);
  color: var(--text);
  height: 100vh;
  display: flex;
  flex-direction: column;
}
.container {
  flex:1;
  display: flex;
  flex-direction: column;
  padding:16px;
}
header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 10px;
  flex-wrap: wrap;
}
header h1 { font-size: 24px; color: var(--accent); text-align:center; }
.nav-buttons {
  display: flex;
  gap:8px;
  align-items: center;
}
.nav-buttons button, .nav-buttons select {
  background:none;
  border:none;
  color: var(--accent);
  font-size:16px;
  cursor:pointer;
  padding:4px 8px;
  transition: all 0.35s ease;
}
.nav-buttons button:hover, .nav-buttons select:hover { background: rgba(0,229,255,0.2); }

.calendar {
  background: var(--card);
  border-radius: 12px;
  flex:1;
  display:flex;
  flex-direction: column;
}
.grid {
  display:grid;
  grid-template-columns: repeat(7,1fr);
  gap: var(--gap);
  flex:1;
}
.day {
  background:#1c1f23;  /* couleur unie des cases */
  border-radius:8px;
  padding:6px;
  border:1px solid var(--border);
  display:flex;
  flex-direction: column;
  overflow:hidden;
  height:100px; /* taille fixe des cases */
  transition: transform 0.25s ease;
}
.day.today { border:2px solid var(--accent); }
.day.past { background:#0f1113; color:#555; }
.day.future { background:#1c1f23; color:#eaeaea; }

.day-header { display:flex; justify-content:space-between; font-size: var(--days-font); margin-bottom:2px; }
.day .date { font-weight:600; font-size: var(--days-font); }
.events { flex:1; display:flex; flex-direction: column; gap:2px; overflow:hidden; }
.event { display:flex; align-items:center; gap:4px; padding:2px 4px; font-size: var(--event-font); border-radius:6px; background: rgba(0,0,0,0.3); cursor:pointer; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }
.c-reception { color:#109c53; } /* vert */
.c-smr { color:#3644b3; } /* bleu */

#popup {
  position:fixed;
  top:50%; left:50%;
  transform: translate(-50%,-50%);
  background:#1c1f23;
  color:#fff;
  padding:16px;
  border-radius:12px;
  box-shadow:0 0 20px rgba(0,0,0,0.8);
  z-index:20;
  max-width:90%;
  min-width:300px;
  display:none;
}
#popup h3 { margin-bottom:8px; }
#popup .close { position:absolute; top:8px; right:12px; cursor:pointer; font-weight:bold; font-size:18px; }

@media(max-width:900px){ .grid{ grid-template-columns: repeat(2,1fr); } }
@media(max-width:520px){ .grid{ grid-template-columns: repeat(1,1fr); } }
</style>
</head>
<body>

<div class="container">
  <header>
    <h1 id="month-title">Mois</h1>
    <div class="nav-buttons">
      <button id="prev-week">&lt;</button>
      <button id="today-btn">Aujourd'hui</button>
      <button id="next-week">&gt;</button>
      <select id="weeks-select">
        <option value="3">3 semaines</option>
        <option value="4" selected>4 semaines</option>
      </select>
    </div>
  </header>
  <div class="calendar">
    <div class="grid" id="grid"></div>
  </div>
</div>

<div id="popup">
  <span class="close" onclick="popup.style.display='none'">&times;</span>
  <h3 id="popup-title"></h3>
  <div id="popup-time"></div>
</div>

<script>
/* ==== CONFIGURATION ==== */
const API_KEY = 'AIzaSyDkQkqPoOGf8umYg2dbeTU0THfLlJnCjXo';
const CALENDARS = [
  { id:'receptionroulier@gmail.com', key:'reception', css:'c-reception'},
  { id:'smr.programme@gmail.com', key:'smr', css:'c-smr'}
];
const CACHE_TTL = 120000;

let WEEKS = 4;
let gridStartDate;
const gridEl = document.getElementById('grid');
const monthTitle = document.getElementById('month-title');
const popup = document.getElementById('popup');
const popupTitle = document.getElementById('popup-title');
const popupTime = document.getElementById('popup-time');
const weeksSelect = document.getElementById('weeks-select');
const prevBtn = document.getElementById('prev-week');
const nextBtn = document.getElementById('next-week');
const todayBtn = document.getElementById('today-btn');

const fmtDate = d => d.toISOString().split('T')[0];
const pad = n => n<10?'0'+n:n;
const fmtTime = dt => dt?pad(new Date(dt).getHours())+':'+pad(new Date(dt).getMinutes()):'';
const shortTitle = (s,max=60)=> s.length>max?s.slice(0,max-1)+'…':s;

/* ==== DATE DE DÉBUT ==== */
const computeGridStart = refDate => {
  const d = new Date(refDate);
  d.setHours(0,0,0,0);
  const day = d.getDay();
  const mondayThisWeek = new Date(d);
  mondayThisWeek.setDate(d.getDate() - ((day + 6) % 7));
  return mondayThisWeek;
};

/* ==== CALENDAR RENDER ==== */
async function renderCalendar(){
  const dates=[];
  for(let w=0; w<WEEKS; w++){
    for(let i=0;i<7;i++){
      const d=new Date(gridStartDate); d.setDate(d.getDate()+w*7+i);
      dates.push(d);
    }
  }

  gridEl.style.gridTemplateRows=`repeat(${WEEKS},1fr)`;
  gridEl.innerHTML='';
  const dayNames=['Lun','Mar','Mer','Jeu','Ven','Sam','Dim'];
  dates.forEach(d=>{
    const dayEl=document.createElement('div');
    dayEl.className='day';
    dayEl.dataset.date=fmtDate(d);
    dayEl.innerHTML=`<div class="day-header"><div>${dayNames[(d.getDay()+6)%7]}</div><div class="date">${d.getDate()}</div></div><div class="events"></div>`;
    gridEl.appendChild(dayEl);
  });

  const monthNames=["Janvier","Février","Mars","Avril","Mai","Juin","Juillet","Août","Septembre","Octobre","Novembre","Décembre"];
  monthTitle.textContent = monthNames[dates[0].getMonth()]+' '+dates[0].getFullYear();
}

/* ==== NAVIGATION ==== */
prevBtn.onclick = ()=>{ gridStartDate.setDate(gridStartDate.getDate()-7); renderCalendar(); };
nextBtn.onclick = ()=>{ gridStartDate.setDate(gridStartDate.getDate()+7); renderCalendar(); };
todayBtn.onclick = ()=>{ gridStartDate = computeGridStart(new Date()); renderCalendar(); };
weeksSelect.onchange = e => { WEEKS = parseInt(e.target.value); renderCalendar(); };

gridStartDate = computeGridStart(new Date());
renderCalendar();
</script>

</body>
</html>
